<?php
/**
 * @file
 * Code for the erpal_docs_helper module.
 */

module_load_include('inc', 'erpal_docs_helper', 'erpal_docs_helper.token');
 
/**
* Implements hook_form_alter
*/
function showroom_helper_form_alter(&$form, $form_state, $form_id) {

  $field_types = _filefield_paths_get_field_types();
  if (isset($form['#field']) && in_array($form['#field']['type'], array_keys($field_types))) {
    // Replacement patterns for field.
    $form['instance']['settings']['filefield_paths']['token_tree_showroom'] = array(
      '#type' => 'fieldset',
      '#title' => t('Replacement patterns showroom'),
      '#collapsible' => TRUE,
      '#collapsed' => TRUE,
      '#description' => theme('token_tree', array('global_types' => FALSE, 'token_types' => array('showroom'))),
      '#weight' => 10,
    );
  }
} 
 
/**
* This function is called in header area of documents view
*/
function _erpal_docs_helper_view_documents_header_content()
{
  $q = current_path();
  $add_erpal_activity =  _erpal_docs_helper_create_document_link();
  
  $my_content = array(
    $add_erpal_activity,
  );
  
  //ask all other modules for content in the header area of the view
  $other_module_content = module_invoke_all('view_documents_header_content');
  
  $all_content = array_merge($other_module_content, $my_content);
  
  $content = '';
  foreach ($all_content as $a_content) {
    $content .= '<br>'.$a_content;
  }
  
  return $content;
}

/**
* Helper function to create new document link
*/
function _erpal_docs_helper_create_document_link($q_arg = false, $query_arr = array())
{
  if (!$q_arg)
    $q = current_path();
  else 
    $q = $q_arg;
  
  if (!isset($query_arr['destination']) || $q_arg)
    $query_arr['destination'] = $q;
  
  return l(
    t("Create new document"), "node/add/erpal-file", array(
        'query' => $query_arr,
    )
  );
}